<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schiffe versenken</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f4f4f4;
        }

        .game-container {
            display: flex;
            align-items: center;
            position: relative;
        }

        canvas {
            position: absolute;
            z-index: 1;
        }

        table {
            border-collapse: collapse;
            margin: 10px;
            z-index: 2;
            position: relative;
        }

        table td {
            width: 30px;
            height: 30px;
            border: 1px solid white;
        }

        .controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <canvas id="playerCanvas"></canvas>
        <table id="playerTable"></table>
        
        <canvas id="opponentCanvas"></canvas>
        <table id="opponentTable"></table>
        
        <div class="controls">
            <span id="currentPlayerText">Spieler 1 ist dran</span>
            <input type="text" id="formula" placeholder="Formel eingeben (z.B. 1,3 für y=1x+3)">
            <button id="shootButton">Schießen</button>
            <button id="resetButton">Reset</button>
        </div>
    </div>

    <script>
        const playerCanvas = document.getElementById('playerCanvas');
        const opponentCanvas = document.getElementById('opponentCanvas');
        const playerTable = document.getElementById('playerTable');
        const opponentTable = document.getElementById('opponentTable');
        const shootButton = document.getElementById('shootButton');
        const currentPlayerText = document.getElementById('currentPlayerText');

        const gridSize = 10;
        const cellSize = 30;

        playerCanvas.width = opponentCanvas.width = gridSize * cellSize;
        playerCanvas.height = opponentCanvas.height = gridSize * cellSize;

        let currentPlayer = 1;
        const playerShips = [];
        const opponentShips = [];

        const createTable = (table) => {
            for (let i = 0; i < gridSize; i++) {
                const row = table.insertRow();
                for (let j = 0; j < gridSize; j++) {
                    row.insertCell();
                }
            }
        }

        createTable(playerTable);
        createTable(opponentTable);

        playerTable.addEventListener('click', (e) => {
            if (currentPlayer === 1) {
                const cell = e.target;
                const rowIndex = cell.parentNode.rowIndex;
                const cellIndex = cell.cellIndex;
                playerShips.push([rowIndex, cellIndex]);
                cell.style.backgroundColor = 'blue';
            }
        });

        opponentTable.addEventListener('click', (e) => {
            if (currentPlayer === 2) {
                const cell = e.target;
                const rowIndex = cell.parentNode.rowIndex;
                const cellIndex = cell.cellIndex;
                opponentShips.push([rowIndex, cellIndex]);
                cell.style.backgroundColor = 'red';
            }
        });

        shootButton.addEventListener('click', () => {
            const formula = document.getElementById('formula').value;
            const parts = formula.split(',').map(Number);

            if (parts.length !== 2 || parts.some(isNaN)) {
                alert("Ungültige Eingabe. Bitte geben Sie eine gültige lineare Gleichung ein.");
                return;
            }

            const [m, b] = parts;

            const ctx = currentPlayer === 1 ? opponentCanvas.getContext('2d') : playerCanvas.getContext('2d');
            ctx.beginPath();
            ctx.moveTo(0, b * cellSize);
            ctx.lineTo(gridSize * cellSize, (m * gridSize + b) * cellSize);
            ctx.stroke();

            let hit = false;
            const ships = currentPlayer === 1 ? opponentShips : playerShips;
            for (const [row, cell] of ships) {
                const y = m * cell + b;
                if (Math.abs(y - row) < 0.5) {
                    hit = true;
                    if (currentPlayer === 1) {
                        opponentTable.rows[row].cells[cell].style.backgroundColor = 'green';
                    } else {
                        playerTable.rows[row].cells[cell].style.backgroundColor = 'green';
                    }
                }
            }

            if (!hit) {
                if (currentPlayer === 1) {
                    opponentCanvas.getContext('2d').fillStyle = 'gray';
                    opponentCanvas.getContext('2d').fillRect(0, 0, gridSize * cellSize, gridSize * cellSize);
                } else {
                    playerCanvas.getContext('2d').fillStyle = 'gray';
                    playerCanvas.getContext('2d').fillRect(0, 0, gridSize * cellSize, gridSize * cellSize);
                }
            }

            currentPlayer = currentPlayer === 1 ? 2 : 1;
            currentPlayerText.innerText = `Spieler ${currentPlayer} ist dran`;
        });

        const resetGame = () => {
            playerCanvas.getContext('2d').clearRect(0, 0, gridSize * cellSize, gridSize * cellSize);
            opponentCanvas.getContext('2d').clearRect(0, 0, gridSize * cellSize, gridSize * cellSize);

            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    playerTable.rows[i].cells[j].style.backgroundColor = '';
                    opponentTable.rows[i].cells[j].style.backgroundColor = '';
                }
            }

            playerShips.length = 0;
            opponentShips.length = 0;
            currentPlayer = 1;
            currentPlayerText.innerText = `Spieler ${currentPlayer} ist dran`;
        }

        document.getElementById('resetButton').addEventListener('click', resetGame);
    </script>
</body>
</html>
